
{% extends "base.html" %}

{% block title %}Создать уведомление - {{ get_translation('app_title') }}{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-12 col-md-8 col-lg-6">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">
                    <i class="fas fa-bell me-2"></i>
                    Создать новое уведомление
                </h4>
            </div>
            <div class="card-body">
                <form method="POST">
                    <div class="mb-3">
                        <label for="message_text" class="form-label">
                            <i class="fas fa-comment me-1"></i>
                            Текст уведомления <span class="text-danger">*</span>
                        </label>
                        <textarea class="form-control" id="message_text" name="message_text" 
                                rows="3" required maxlength="500"
                                placeholder="Введите текст уведомления..."></textarea>
                        <div class="form-text">Максимум 500 символов</div>
                    </div>

                    <div class="mb-3">
                        <label for="send_time" class="form-label">
                            <i class="fas fa-clock me-1"></i>
                            Время отправки <span class="text-danger">*</span>
                        </label>
                        <input type="time" class="form-control" id="send_time" name="send_time" required>
                        <div class="form-text">Время по Алматы (UTC+6)</div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">
                            <i class="fas fa-calendar me-1"></i>
                            Дни недели <span class="text-danger">*</span>
                        </label>
                        <div class="row">
                            <div class="col-6 col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="1" 
                                           id="day1" name="days_of_week">
                                    <label class="form-check-label" for="day1">Понедельник</label>
                                </div>
                            </div>
                            <div class="col-6 col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="2" 
                                           id="day2" name="days_of_week">
                                    <label class="form-check-label" for="day2">Вторник</label>
                                </div>
                            </div>
                            <div class="col-6 col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="3" 
                                           id="day3" name="days_of_week">
                                    <label class="form-check-label" for="day3">Среда</label>
                                </div>
                            </div>
                            <div class="col-6 col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="4" 
                                           id="day4" name="days_of_week">
                                    <label class="form-check-label" for="day4">Четверг</label>
                                </div>
                            </div>
                            <div class="col-6 col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="5" 
                                           id="day5" name="days_of_week">
                                    <label class="form-check-label" for="day5">Пятница</label>
                                </div>
                            </div>
                            <div class="col-6 col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="6" 
                                           id="day6" name="days_of_week">
                                    <label class="form-check-label" for="day6">Суббота</label>
                                </div>
                            </div>
                            <div class="col-6 col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="7" 
                                           id="day7" name="days_of_week">
                                    <label class="form-check-label" for="day7">Воскресенье</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-text">Выберите дни, когда нужно отправлять уведомления</div>
                    </div>

                    <div class="mb-3">
                        <label for="weeks_count" class="form-label">
                            <i class="fas fa-repeat me-1"></i>
                            Количество недель <span class="text-danger">*</span>
                        </label>
                        <select class="form-select" id="weeks_count" name="weeks_count" required>
                            <option value="1">1 неделя</option>
                            <option value="2">2 недели</option>
                            <option value="3">3 недели</option>
                            <option value="4" selected>4 недели (1 месяц)</option>
                            <option value="8">8 недель (2 месяца)</option>
                            <option value="12">12 недель (3 месяца)</option>
                            <option value="24">24 недели (6 месяцев)</option>
                            <option value="52">52 недели (1 год)</option>
                        </select>
                        <div class="form-text">На сколько недель создать уведомление</div>
                    </div>

                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Как работает:</strong>
                        <ul class="mb-0 mt-2">
                            <li>Первое сообщение отправляется в указанное время и удаляется через 9 минут</li>
                            <li>Второе сообщение приходит через 10 минут и удаляется через 9 минут</li>
                            <li>Третье сообщение приходит еще через 10 минут и остается постоянно</li>
                        </ul>
                    </div>

                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>
                            Создать уведомление
                        </button>
                        <a href="{{ url_for('notifications') }}" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left me-2"></i>
                            Отмена
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Validate at least one day is selected
    const form = document.querySelector('form');
    const checkboxes = document.querySelectorAll('input[name="days_of_week"]');
    
    form.addEventListener('submit', function(e) {
        const checked = Array.from(checkboxes).some(cb => cb.checked);
        if (!checked) {
            e.preventDefault();
            alert('Выберите хотя бы один день недели');
            return false;
        }
    });
    
    // Character counter for message text
    const messageText = document.getElementById('message_text');
    const counter = document.createElement('small');
    counter.className = 'form-text text-muted';
    messageText.parentNode.appendChild(counter);
    
    function updateCounter() {
        const remaining = 500 - messageText.value.length;
        counter.textContent = `Осталось символов: ${remaining}`;
        if (remaining < 50) {
            counter.className = 'form-text text-warning';
        } else if (remaining < 0) {
            counter.className = 'form-text text-danger';
        } else {
            counter.className = 'form-text text-muted';
        }
    }
    
    messageText.addEventListener('input', updateCounter);
    updateCounter();
});
</script>
{% endblock %}
